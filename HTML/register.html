<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Account</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="../CSS/stylesregister.css">
</head>
<body>

<img class = "RegisterDuck" src = "../webpageImageAssets/registerDuck.png" alt = "game logo">

<form id = "MainForm" class  = "w-25 m-4">

    <div class = "enterEmail">
        <input type = "email" class = "form-control" id = "emailInput" placeholder="Email">
        <label for = "emailInput">Email</label>
    </div>
    <div class = "enterPassword">
        <input type = "password" class = "form-control" id = "passwordInput" placeholder="Password">
        <label for = "passwordInput">Password</label>
    </div>
    <div class = "enterFName">
        <input type = "text" class = "form-control" id = "fNameInput" placeholder="First Name">
        <label for = "fNameInput">First Name</label>
    </div>
    <div class = "enterLName">
        <input type = "text" class = "form-control" id = "lNameInput" placeholder="Last Name">
        <label for = "lNameInput">Last Name</label>
    </div>
    <button type = "submit" class = "loginButton">Create Account</button>
    <a href="login.html">
        <button type="button" class = "signUpButton">Already have an account?</button></a>
    <img class = "background" src = "../webpageImageAssets/greenBackground.jpg" alt = "background">

</form>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
    import { getDatabase, set, ref } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword} from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyAAAJkTBJ-CY7QOWlOHZ3_8glgOfAKRopg",
        authDomain: "duck-deckers.firebaseapp.com",
        databaseURL: "https://duck-deckers-default-rtdb.firebaseio.com",
        projectId: "duck-deckers",
        storageBucket: "duck-deckers.appspot.com",
        messagingSenderId: "499331695357",
        appId: "1:499331695357:web:5d45713977c74c6bb1b494",
        measurementId: "G-FG9BK67MLF"
    }

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const auth = getAuth(app);

    //grab all the data from the form
    let EmailInput = document.getElementById('emailInput');
    let PasswordInput = document.getElementById('passwordInput');
    let FNameInput = document.getElementById('fNameInput');
    let LNameInput = document.getElementById('lNameInput');
    let MainForm = document.getElementById('MainForm');

    //create our registerUser function to hit Firebase
    let RegisterUser = evt =>{
        evt.preventDefault(); //takes care of our promise
        createUserWithEmailAndPassword(auth, EmailInput.value, PasswordInput.value)
            .then((credentials)=>{
                const initialCash = 100; //Setting the initial cash a user will start with
                set(ref(db, 'users/'+credentials.user.uid), {
                    firstName: FNameInput.value,
                    lastName: LNameInput.value,
                    currentRoom: null, //not in a room when account is created
                    cash: initialCash
                })
                setTimeout(()=> {window.location.href='home.html'}, 1000); //one second wait, so we can write data before switching pages
            })
            .catch((error)=>{
                alert(error.message); //pop up on the webpage
                console.log(error.code); //log the error code number
                console.log(error.message); //logs the error message
            })
    }

    MainForm.addEventListener('submit', RegisterUser); //when the CreateUser button is clicked, run our function


</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

</body>
</html>
